<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>plakat-AR_wystawaGSW</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar-nft.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    #startBtn {
      position: absolute; bottom: 20px; left: 20px; padding: 10px 20px;
      background: #333; color: #fff; border: none; z-index: 20; cursor: pointer;
    }
    video#video {
      display: block; width: 150px; position: absolute;
      bottom: 10px; left: 10px; z-index: 10;
    }
  </style>
</head>

<body>
  <a-scene
    embedded
    arjs="sourceType: webcam; trackingMethod: best; debugUIEnabled: true; basePath: ./"
    renderer="colorManagement: true; physicallyCorrectLights: true; logarithmicDepthBuffer: true; antialias: true;"
  >
    <a-nft
      type="nft"
      url="https://mentalnyjez.github.io/plakat-AR_wystawaGSW/marker/plakat_AR"
      smooth="true"
      smoothCount="5"
      smoothTolerance="0.01"
      smoothThreshold="5"
    >
      <!-- PUSTY PLANE na teksturę wideo -->
      <a-plane
        id="videoPlane"
        width="2"
        height="1.2"
        position="0 0 0.5"
        material="color: gray; opacity: 0.8"
      ></a-plane>
    </a-nft>

    <a-entity camera></a-entity>
  </a-scene>

  <!-- WIDEO podglądowe -->
  <video 
    id="video" 
    src="animacja.mp4"
    loop
    playsinline
    crossorigin="anonymous"
    muted
    style="display: block; width: 150px; position: absolute; bottom: 10px; left: 10px; z-index: 10;"
  ></video>

  <button id="startBtn">▶ Start Video</button>

  <script>
    console.log('✅ Scena AR załadowana');
    const nftMarker = document.querySelector('a-nft');
    const video = document.querySelector('#video');
    const videoPlane = document.querySelector('#videoPlane');
    const startBtn = document.querySelector('#startBtn');

    // Start ręczny - dla iOS/Chrome
    startBtn.addEventListener('click', () => {
      video.play();
      console.log('▶ Video started manually');
    });

    // PRZYPISANIE tekstury video DO PLANU, kiedy marker wykryty
    nftMarker.addEventListener('markerFound', function() {
      console.log('✅ Marker FOUND!');
      video.play().then(() => console.log('▶ AR Video started automatically')).catch(err => console.log('⛔ Video Play Error:', err));
      videoPlane.setAttribute('material', 'src', '#video');

      // Wymuszenie aktualizacji tekstury
      const mesh = videoPlane.getObject3D('mesh');
      if (mesh && mesh.material.map) {
        mesh.material.map.needsUpdate = true;
        console.log('✅ Texture updated on videoPlane');
      }
    });

    // Marker LOST - stop video
    nftMarker.addEventListener('markerLost', function() {
      console.log('❌ Marker LOST!');
      video.pause();
    });
  </script>
</body>
</html>
